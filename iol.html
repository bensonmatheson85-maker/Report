<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Reports & Staff Panel (Upgraded)</title>
<style>
body { margin:0; font-family: Arial, sans-serif; background:#0f1115; color:#eaeaea; }
.center { display:flex; align-items:center; justify-content:center; min-height:100vh; }
.box { background:#161a22; padding:25px; border-radius:12px; border:1px solid #2a2f3a; width:500px; max-width:95%; box-shadow:0 0 20px rgba(0,0,0,0.4); }
input, select, textarea, button { width:100%; margin-top:10px; padding:10px; background:#0f1115; color:#eaeaea; border:1px solid #2a2f3a; border-radius:6px; }
button { background:#5865f2; cursor:pointer; font-weight:bold; }
button:hover { opacity:0.9; }
h1 { margin-top:0; text-align:center; }
.hidden { display:none; }
.report-card { background:#1c2030; padding:10px; border-radius:6px; margin-bottom:10px; }
video { width:100%; border-radius:6px; margin-top:10px; }
.modal { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); display:flex; align-items:center; justify-content:center; z-index:10; }
.modal-content { background:#161a22; padding:20px; border-radius:12px; width:400px; }
.search-bar { margin-bottom:10px; padding:8px; border-radius:6px; border:1px solid #2a2f3a; background:#0f1115; color:#eaeaea; }
</style>
</head>
<body>

<div class="center" id="mainMenu">
  <div class="box">
    <h1>Welcome</h1>
    <button onclick="showSubmission()">Submit a Report</button>
    <button onclick="showStaffLogin()">Access Staff Panel</button>
  </div>
</div>

<div class="center hidden" id="submissionScreen">
  <div class="box">
    <h1>Submit a Report</h1>
    <label>Your Roblox Username</label>
    <input id="reporter" type="text" placeholder="Your username" />
    <label>Reported Player Username</label>
    <input id="reported" type="text" placeholder="Offender's username" />
    <label>Rule Broken</label>
    <select id="rule">
      <option>Exploiting / Cheating</option>
      <option>Harassment</option>
      <option>Inappropriate Content</option>
      <option>Abuse of Bugs</option>
      <option>Other</option>
    </select>
    <label>Description</label>
    <textarea id="description" rows="4" placeholder="Explain what happened..."></textarea>
    <label>Evidence Clip / File</label>
    <input id="clipFile" type="file" accept="video/*" />
    <button onclick="submitReport()">Submit Report</button>
    <button onclick="backToMenu()">Back</button>
    <div id="successMsg" style="color:#2ecc71; display:none; text-align:center; margin-top:10px;">Report submitted successfully.</div>
  </div>
</div>

<div class="center hidden" id="staffLoginScreen">
  <div class="box">
    <h1>Staff Login</h1>
    <input type="password" id="staffPassword" placeholder="Enter password" />
    <button onclick="checkPassword()">Login</button>
    <button onclick="backToMenu()">Back</button>
    <p id="loginMsg" style="color:#e74c3c; display:none; text-align:center; margin-top:10px;">Incorrect password</p>
  </div>
</div>

<div class="center hidden" id="staffPanel">
  <div class="box" style="margin:20px auto; max-height:80vh; overflow-y:auto;">
    <h1>Staff Panel</h1>
    <input class="search-bar" id="searchReports" placeholder="Search by reporter or reported username..." oninput="loadReports()" />
    <label>Sort by:</label>
    <select id="sortReports" onchange="loadReports()">
      <option value="newest">Newest</option>
      <option value="oldest">Oldest</option>
    </select>
    <div id="reportList"></div>
    <button onclick="exportReports()" style="margin-top:10px;">Export Reports JSON</button>
    <button onclick="logout()" style="margin-top:10px;">Logout</button>
  </div>
</div>

<div class="hidden" id="banModal" class="modal">
  <div class="modal-content">
    <h2>Ban User</h2>
    <label>Reason</label>
    <textarea id="banReason" rows="3" placeholder="Enter reason for ban..."></textarea>
    <label>Rule Broken</label>
    <select id="banRule">
      <option>Exploiting / Cheating</option>
      <option>Harassment</option>
      <option>Inappropriate Content</option>
      <option>Abuse of Bugs</option>
      <option>Other</option>
    </select>
    <button id="confirmBanBtn">Confirm Ban</button>
    <button onclick="closeBanModal()">Cancel</button>
  </div>
</div>

<script>
let currentBanIndex = null;
const webhookURL='https://discord.com/api/webhooks/1462576552079392885/LOY2wvZfaIwBmQgCGB2KdTzKnP7RRnfO4dYg-UiXXDqX9ArrImxLNalPqjSJcdjh0jcj';

function showSubmission(){ document.getElementById('mainMenu').classList.add('hidden'); document.getElementById('submissionScreen').classList.remove('hidden'); }
function showStaffLogin(){ document.getElementById('mainMenu').classList.add('hidden'); document.getElementById('staffLoginScreen').classList.remove('hidden'); }
function backToMenu(){ document.getElementById('submissionScreen').classList.add('hidden'); document.getElementById('staffLoginScreen').classList.add('hidden'); document.getElementById('mainMenu').classList.remove('hidden'); }
function logout(){ document.getElementById('staffPanel').classList.add('hidden'); document.getElementById('mainMenu').classList.remove('hidden'); }

function checkPassword(){
  const pw=document.getElementById('staffPassword').value;
  if(pw==='chundun'){
    document.getElementById('staffLoginScreen').classList.add('hidden');
    document.getElementById('staffPanel').classList.remove('hidden');
    loadReports();
  } else { document.getElementById('loginMsg').style.display='block'; }
}

function sendDiscordWebhook(content){
  fetch(webhookURL,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({content})})
  .catch(err=>console.error('Webhook error:',err));
}

function submitReport(){
  const fileInput = document.getElementById('clipFile');
  const reader = new FileReader();
  reader.onload = function(e){
    const clipData = e.target.result;
    const report={
      reporter:document.getElementById('reporter').value,
      reported:document.getElementById('reported').value,
      rule:document.getElementById('rule').value,
      description:document.getElementById('description').value,
      clip:clipData || null,
      timestamp:Date.now()
    };
    let reports=JSON.parse(localStorage.getItem('reports'))||[];
    reports.push(report);
    localStorage.setItem('reports',JSON.stringify(reports));
    document.getElementById('successMsg').style.display='block';
    setTimeout(()=>{document.getElementById('successMsg').style.display='none';},2000);
    document.getElementById('reporter').value='';
    document.getElementById('reported').value='';
    document.getElementById('rule').selectedIndex=0;
    document.getElementById('description').value='';
    document.getElementById('clipFile').value='';
    const discordMessage=`**New Report Submitted!**\nReporter: ${report.reporter}\nReported: ${report.reported}\nRule: ${report.rule}\nDescription: ${report.description}`;
    sendDiscordWebhook(discordMessage);
    loadReports();
  };
  if(fileInput.files[0]) reader.readAsDataURL(fileInput.files[0]);
  else reader.onload({target:{result:null}});
}

function loadReports(){
  const reports=JSON.parse(localStorage.getItem('reports'))||[];
  const container=document.getElementById('reportList');
  if(!container) return;
  container.innerHTML='';
  const searchQuery=document.getElementById('searchReports').value.toLowerCase();
  const sortMethod=document.getElementById('sortReports').value;
  let filteredReports = reports.filter(r=>r.reporter.toLowerCase().includes(searchQuery)||r.reported.toLowerCase().includes(searchQuery));
  if(sortMethod==='newest') filteredReports.sort((a,b)=>b.timestamp-a.timestamp);
  else filteredReports.sort((a,b)=>a.timestamp-b.timestamp);
  if(filteredReports.length===0){ container.innerHTML='<p>No reports found.</p>'; return; }
  filteredReports.forEach((r,index)=>{
    const card=document.createElement('div');
    card.className='report-card';
    const date = new Date(r.timestamp).toLocaleString();
    card.innerHTML=`<p><strong>Reporter:</strong> ${r.reporter}</p>
                    <p><strong>Reported:</strong> ${r.reported}</p>
                    <p><strong>Rule:</strong> ${r.rule}</p>
                    <p><strong>Description:</strong> ${r.description}</p>
                    <p><strong>Submitted:</strong> ${date}</p>
                    ${r.clip?`<video controls><source src="${r.clip}" type="video/mp4"></video>`:''}
                    <div style='margin-top:8px;'>
                      <button style='margin-right:6px;' onclick='openBanModal(${index})'>Ban</button>
                      <button onclick='falseReport(${index})'>False</button>
                    </div>`;
    container.appendChild(card);
  });
}

function openBanModal(index){ currentBanIndex=index; document.getElementById('banModal').classList.remove('hidden'); }
function closeBanModal(){ currentBanIndex=null; document.getElementById('banModal').classList.add('hidden'); document.getElementById('banReason').value=''; document.getElementById('banRule').selectedIndex=0; }

document.getElementById('confirmBanBtn').addEventListener('click',()=>{
  if(currentBanIndex===null) return;
  const reports=JSON.parse(localStorage.getItem('reports'))||[];
  const r=reports.splice(currentBanIndex,1)[0];
  localStorage.setItem('reports',JSON.stringify(reports));
  const reason=document.getElementById('banReason').value||'No reason provided';
  const rule=document.getElementById('banRule').value;
  const message=`**User Banned!**\nUser: ${r.reported}\nRule Broken: ${rule}\nReason: ${reason}\nReporter: ${r.reporter}`;
  sendDiscordWebhook(message);
  loadReports();
  closeBanModal();
  alert(`${r.reported} has been banned.`);
});

function falseReport(index){
  const reports=JSON.parse(localStorage.getItem('reports'))||[];
  const r=reports.splice(index,1)[0];
  localStorage.setItem('reports',JSON.stringify(reports));
  loadReports();
  alert(`Report from ${r.reporter} marked as false.`);
}

function exportReports(){
  const dataStr = JSON.stringify(JSON.parse(localStorage.getItem('reports'))||[], null, 2);
  const blob = new Blob([dataStr], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href=url;
  a.download='reports.json';
  a.click();
  URL.revokeObjectURL(url);
}

window.addEventListener('storage',()=>{ loadReports(); });
</script>

</body>
</html>